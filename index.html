<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>HTMLX Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#0b0b0b;color:#fff}
header{background:#111;padding:12px;display:flex;justify-content:space-between;align-items:center}
button{padding:8px 14px;border:0;border-radius:6px;background:#27ae60;color:#fff;cursor:pointer}
button.alt{background:#3498db}
button.red{background:#e74c3c}
input,textarea{width:100%;background:#111;color:#0f0;border:1px solid #333;border-radius:6px;padding:8px}
textarea{height:130px}
.box{border:1px solid #333;border-radius:10px;padding:12px;margin:10px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
iframe{width:100%;height:300px;border:1px solid #333;background:#fff}
.card{border:1px solid #333;border-radius:10px;padding:10px;margin-bottom:10px}
img{max-width:100%;border-radius:8px}
small{opacity:.7}
</style>
</head>
<body>

<header>
 <b>üöÄ HTMLX Hub</b>
 <div>
  <button onclick="UI.show('editor')">Criar</button>
  <button class="alt" onclick="UI.show('feed')">Marketplace</button>
  <button class="red" onclick="logout()">Sair</button>
 </div>
</header>

<div id="view"></div>

<script>
/* ===================================================
   SISTEMA DE CONTA (LOCAL ‚Äì PRONTO PARA FIREBASE)
=================================================== */
let user = JSON.parse(localStorage.getItem("htmlx_user"));
if(!user){
 const name = prompt("Seu nome:");
 user = {id:Date.now(),name,pro:false};
 localStorage.setItem("htmlx_user",JSON.stringify(user));
}
function logout(){
 localStorage.removeItem("htmlx_user");
 location.reload();
}

/* ===================================================
   BANCO (LOCAL ‚Üí SUBSTITU√çVEL POR FIREBASE)
=================================================== */
const DB={
 apps:JSON.parse(localStorage.getItem("htmlx_apps"))||[],
 save(){localStorage.setItem("htmlx_apps",JSON.stringify(this.apps))}
};

/* ===================================================
   HTMLX ‚Äì LINGUAGEM OFICIAL
=================================================== */
function parseHTMLX(code){
 let r={html:"",css:"",js:"",meta:{}},mode="";
 code.split("\n").forEach(l=>{
  if(l.startsWith("@")) mode=l.replace("@","").trim();
  else{
   if(mode==="HTML") r.html+=l+"\n";
   if(mode==="CSS") r.css+=l+"\n";
   if(mode==="JS") r.js+=l+"\n";
   if(mode==="META"){
    let p=l.split(":");
    if(p[1]) r.meta[p[0].trim()]=p[1].trim();
   }
  }
 });
 return r;
}

/* ===================================================
   UI
=================================================== */
const UI={
 show(v,data){
  view.innerHTML=Views[v](data);
 }
};

/* ===================================================
   VIEWS
=================================================== */
const Views={

 feed:()=>`
 <div class="box">
  <h2>üåç Marketplace</h2>
  ${DB.apps.map((a,i)=>`
   <div class="card">
    ${a.cover?`<img src="${a.cover}">`:""}
    <b>${a.meta.title||"Sem t√≠tulo"}</b><br>
    <small>Autor: ${a.author}</small><br>
    ‚ù§Ô∏è ${a.likes}
    <button onclick="like(${i})">Curtir</button>
    <button onclick="openApp(${i})">Abrir</button>
   </div>
  `).join("")}
 </div>
 `,

 editor:()=>`
 <div class="box">
  <h2>‚úçÔ∏è Editor HTMLX</h2>

  <textarea id="code">@META
title: Meu App HTMLX

@HTML
<h1>Hello HTMLX</h1>

@CSS
body{background:#222;color:white;text-align:center}

@JS
console.log("Rodando HTMLX")</textarea>

  <input type="file" id="cover">
  <br><br>
  <button onclick="run()">Executar</button>
  <button onclick="publish()">Publicar</button>
  <button onclick="exportApp()">Exportar HTML</button>

  <iframe id="preview"></iframe>
 </div>
 `,

 viewer:(a)=>`
 <div class="box">
  <h2>${a.meta.title}</h2>
  ${a.cover?`<img src="${a.cover}">`:""}
  <iframe sandbox srcdoc="
   <style>${a.css}</style>
   ${a.html}
   <script>${a.js}<\/script>
  "></iframe>

  <h3>üí¨ Coment√°rios</h3>
  ${(a.comments||[]).map(c=>`<div class="card"><b>${c.user}</b>: ${c.text}</div>`).join("")}
  <input id="msg" placeholder="Comentar">
  <button onclick="comment(${DB.apps.indexOf(a)})">Enviar</button>
 </div>
 `
};

/* ===================================================
   A√á√ïES
=================================================== */
function run(){
 const p=parseHTMLX(code.value);
 preview.srcdoc=`<style>${p.css}</style>${p.html}<script>${p.js}<\/script>`;
}

function publish(){
 const p=parseHTMLX(code.value);
 const file=cover.files[0];
 if(file){
  const r=new FileReader();
  r.onload=()=>saveApp(p,r.result);
  r.readAsDataURL(file);
 }else saveApp(p,null);
}

function saveApp(p,cover){
 DB.apps.push({
  ...p,
  cover,
  author:user.name,
  likes:0,
  comments:[]
 });
 DB.save();
 UI.show("feed");
}

function openApp(i){UI.show("viewer",DB.apps[i]);}
function like(i){DB.apps[i].likes++;DB.save();UI.show("feed");}

function comment(i){
 const msg=document.getElementById("msg").value;
 if(!msg) return;
 DB.apps[i].comments.push({user:user.name,text:msg});
 DB.save();
 openApp(i);
}

function exportApp(){
 const p=parseHTMLX(code.value);
 const html=`<!DOCTYPE html><html><head><style>${p.css}</style></head><body>${p.html}<script>${p.js}<\/script></body></html>`;
 const a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([html],{type:"text/html"}));
 a.download="htmlx-app.html";
 a.click();
}

/* ===================================================
   START
=================================================== */
UI.show("feed");
</script>

</body>
</html>
